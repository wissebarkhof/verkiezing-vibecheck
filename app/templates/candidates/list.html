{% extends "base.html" %}

{% block title %}Kandidaten â€” Verkiezing Vibecheck{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-gray-900 mb-6">Kandidaten</h1>

{% if candidates %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {% for party_name, party_candidates in candidates | groupby("party.name") %}
        {% set party_list = party_candidates | list %}
        {% set party_id = loop.index %}
        <div class="bg-white rounded-lg shadow p-4">
            <h2 class="font-semibold text-gray-700 border-b pb-2 mb-3">
                {{ party_list[0].party.abbreviation }}
                <span class="block text-xs text-gray-400 font-normal">{{ party_name }}</span>
            </h2>
            <ul class="space-y-1 text-sm">
                {% for candidate in party_list %}
                <li{% if loop.index > 20 %} class="extra-{{ party_id }} hidden"{% endif %}>
                    <a href="/kandidaten/{{ candidate.id }}" class="flex items-center gap-2 py-0.5 hover:text-blue-600 transition">
                        <span class="font-mono text-xs text-gray-400 w-5 text-right shrink-0">{{ candidate.position_on_list }}.</span>
                        <span class="truncate">{{ candidate.name }}</span>
                        {% if candidate.bluesky_handle %}
                        <span class="ml-auto text-sky-500 shrink-0" title="{{ candidate.bluesky_handle }}">
                            <svg class="w-3 h-3" viewBox="0 0 360 320" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M180 142c-16.3-31.7-60.7-90.8-102-120C36 1 1 16 1 55c0 21 13.3 88.3 22 108 13 31 50 57 85 51-58.7 10-85 43-85 76 0 41 24.7 55 49 55 34.3 0 56.7-20 108-95 51.3 75 73.7 95 108 95 24.3 0 49-14 49-55 0-33-26.3-66-85-76 35 6 72-20 85-51 8.7-19.7 22-87 22-108 0-39-35-54-77-20-41.3 29.2-85.7 88.3-102 120z"/>
                            </svg>
                        </span>
                        {% endif %}
                    </a>
                </li>
                {% endfor %}
            </ul>
            {% if party_list | length > 20 %}
            <button onclick="showMore({{ party_id }}, this)"
                    class="mt-3 text-xs text-blue-600 hover:underline">
                {{ party_list | length - 20 }} meer kandidaten
            </button>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        function showMore(partyId, btn) {
            document.querySelectorAll('.extra-' + partyId).forEach(el => el.classList.remove('hidden'));
            btn.remove();
        }
    </script>
{% else %}
    <p class="text-gray-500">Nog geen kandidaten geladen.</p>
{% endif %}
{% endblock %}
