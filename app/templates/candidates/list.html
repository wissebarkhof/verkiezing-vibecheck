{% extends "base.html" %}

{% block title %}Kandidaten â€” Verkiezing Vibecheck{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-gray-900 mb-6">Kandidaten</h1>

{% set card_gradients = [
    'linear-gradient(90deg,#a0f5e9,#9ddcf2)',
    'linear-gradient(90deg,#9ddcf2,#a6a0f5)',
    'linear-gradient(90deg,#a6a0f5,#eaa0f5)',
    'linear-gradient(90deg,#eaa0f5,#99f09f)',
    'linear-gradient(90deg,#99f09f,#f5ad6e)',
    'linear-gradient(90deg,#f5ad6e,#a0f5e9)',
] %}

{% if parties %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {% for p in parties %}
        {% set ci = loop.index0 % 6 %}
        {% set party_id = loop.index %}
        <div class="bg-white rounded-lg border border-gray-200 card-accent-top p-4"
             style="--card-accent: {{ card_gradients[ci] }}">
            <h2 class="font-semibold text-gray-800 border-b border-gray-100 pb-2 mb-3">
                {{ p.abbreviation }}
                <span class="block text-xs text-gray-400 font-normal">{{ p.name }}</span>
            </h2>
            {% set c_seats = p.current_seats %}
            {% set poll_seats = p.polled_seats %}
            <ul class="space-y-1 text-sm">
                {% for candidate in p.candidates %}
                <li{% if loop.index > 20 %} class="extra-{{ party_id }} hidden"{% endif %}>
                    <a href="/kandidaten/{{ candidate.id }}"
                       class="flex items-center gap-2 py-0.5 text-gray-700 hover:text-gray-900 transition-colors">
                        <span class="font-mono text-xs text-gray-400 w-5 text-right shrink-0">{{ candidate.position_on_list }}.</span>
                        <span class="truncate">{{ candidate.name }}</span>
                        {% if candidate.bluesky_handle %}
                        <span class="ml-auto text-sky-500 shrink-0" title="{{ candidate.bluesky_handle }}">
                            <svg class="w-3 h-3" viewBox="0 0 360 320" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M180 142c-16.3-31.7-60.7-90.8-102-120C36 1 1 16 1 55c0 21 13.3 88.3 22 108 13 31 50 57 85 51-58.7 10-85 43-85 76 0 41 24.7 55 49 55 34.3 0 56.7-20 108-95 51.3 75 73.7 95 108 95 24.3 0 49-14 49-55 0-33-26.3-66-85-76 35 6 72-20 85-51 8.7-19.7 22-87 22-108 0-39-35-54-77-20-41.3 29.2-85.7 88.3-102 120z"/>
                            </svg>
                        </span>
                        {% endif %}
                    </a>
                </li>
                {% if c_seats and candidate.position_on_list == c_seats %}
                <li class="flex items-center gap-1 text-xs text-gray-400 my-0.5">
                    <div class="flex-1 border-t border-gray-200"></div>
                    <span class="shrink-0">{% if poll_seats == c_seats %}{{ c_seats }} huidig / gepolld{% else %}{{ c_seats }} huidig{% endif %}</span>
                    <div class="flex-1 border-t border-gray-200"></div>
                </li>
                {% endif %}
                {% if poll_seats and poll_seats != c_seats and candidate.position_on_list == poll_seats %}
                {% if poll_seats > c_seats %}
                <li class="flex items-center gap-1 text-xs text-green-600 my-0.5">
                    <div class="flex-1 border-t border-green-400"></div>
                    <span class="shrink-0">{{ poll_seats }} gepolld</span>
                    <div class="flex-1 border-t border-green-400"></div>
                </li>
                {% else %}
                <li class="flex items-center gap-1 text-xs text-red-500 my-0.5">
                    <div class="flex-1 border-t border-red-400"></div>
                    <span class="shrink-0">{{ poll_seats }} gepolld</span>
                    <div class="flex-1 border-t border-red-400"></div>
                </li>
                {% endif %}
                {% endif %}
                {% endfor %}
            </ul>
            {% if p.candidates | length > 20 %}
            <button onclick="showMore({{ party_id }}, this)"
                    class="mt-3 text-xs text-gray-400 hover:text-gray-700 transition-colors">
                {{ p.candidates | length - 20 }} meer kandidaten &darr;
            </button>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        function showMore(partyId, btn) {
            document.querySelectorAll('.extra-' + partyId).forEach(el => el.classList.remove('hidden'));
            btn.remove();
        }
    </script>
{% else %}
    <p class="text-gray-500">Nog geen kandidaten geladen.</p>
{% endif %}

{% endblock %}
